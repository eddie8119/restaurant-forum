{"ast":null,"code":"import \"core-js/modules/es.error.cause.js\";\nimport NavTabs from \"../components/NavTabs.vue\";\nimport restaurantsAPI from \"./../apis/restaurants\";\nimport usersAPI from \"./../apis/users\";\nimport { Toast } from \"./../utils/helpers\";\nimport SpinneR from \"../components/SpinneR\";\nexport default {\n  name: \"RestaurantsTop\",\n  components: {\n    NavTabs,\n    SpinneR\n  },\n\n  data() {\n    return {\n      restaurants: [],\n      isLoading: true\n    };\n  },\n\n  created() {\n    this.getRestaurantsTop();\n  },\n\n  methods: {\n    async getRestaurantsTop() {\n      try {\n        const response = await restaurantsAPI.getRestaurantsTop();\n\n        if (response.statusText !== \"OK\") {\n          throw new Error(\"無法載入人氣餐廳，請稍後再試\");\n        }\n\n        this.restaurants = response.data.restaurants;\n        this.isLoading = false;\n      } catch (error) {\n        this.isLoading = false;\n        Toast.fire({\n          icon: \"error\",\n          title: \"無法取得人氣餐廳\"\n        });\n      }\n    },\n\n    async addFavorite(restaurantId) {\n      try {\n        const {\n          data\n        } = await usersAPI.addFavorite({\n          restaurantId\n        }); // 檢測\n\n        if (data.status !== \"success\") {\n          throw new Error(data.message);\n        } //加入\n\n\n        this.restaurants = this.restaurants.map(restaurant => {});\n      } catch (error) {\n        Toast.fire({\n          icon: \"error\",\n          title: \"無法加到我的最愛，請稍後再試\"\n        });\n      }\n    } // async addFavorite(restaurantId) {\n    //   try {\n    //     const { data } = await usersAPI.addFavorite({ restaurantId });\n    //     if (data.status !== \"success\") {\n    //       throw new Error(data.messege);\n    //     }\n    //     this.restaurants = this.restaurants.map((restaurant) => {\n    //       if (restaurant.id !== restaurantId) {\n    //         return restaurant;\n    //       } else {\n    //         return {\n    //           ...restaurant,\n    //           isFavorited: true,\n    //           FavoriteCount: restaurant.FavoriteCount + 1,\n    //         };\n    //       }\n    //     });\n    //   } catch (error) {\n    //     Toast.fire({\n    //       icon: \"error\",\n    //       title: \"無法將餐廳加入最愛，請稍後再試\",\n    //     });\n    //   }\n    // },\n    // async deleteFavorite(restaurantId) {\n    //   try {\n    //     const { data } = await usersAPI.deleteFavorite({ restaurantId });\n    //     if (data.status !== \"success\") {\n    //       throw new Error(data.messege);\n    //     }\n    //     this.restaurants = this.restaurants.map((restaurant) => {\n    //       if (restaurant.id !== restaurantId) {\n    //         return restaurant;\n    //       } else {\n    //         return {\n    //           ...restaurant,\n    //           isFavorited: false,\n    //           FavoriteCount: restaurant.FavoriteCount - 1,\n    //         };\n    //       }\n    //     });\n    //   } catch (error) {\n    //     Toast.fire({\n    //       icon: \"error\",\n    //       title: \"無法將餐廳取消最愛，請稍後再試\",\n    //     });\n    //   }\n    // },\n\n\n  }\n};","map":{"version":3,"mappings":";AA4DA;AACA;AACA;AACA;AACA;AAEA;EACAA,sBADA;EAEAC;IACAC,OADA;IAEAC;EAFA,CAFA;;EAMAC;IACA;MACAC,eADA;MAEAC;IAFA;EAIA,CAXA;;EAYAC;IACA;EACA,CAdA;;EAeAC;IACA;MACA;QACA;;QAEA;UACA;QACA;;QAEA;QACA;MACA,CATA,CASA;QACA;QACAC;UACAC,aADA;UAEAC;QAFA;MAIA;IACA,CAlBA;;IAmBA;MACA;QACA;UAAAP;QAAA;UAAAQ;QAAA,GADA,CAEA;;QACA;UACA;QACA,CALA,CAMA;;;QACA,wCACAC,eAEA,CAHA;MAMA,CAbA,CAaA;QACAJ;UACAC,aADA;UAEAC;QAFA;MAIA;IACA,CAvCA,CAwCA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;;;EAvFA;AAfA","names":["name","components","NavTabs","SpinneR","data","restaurants","isLoading","created","methods","Toast","icon","title","restaurantId","restaurant"],"sourceRoot":"src/views","sources":["RestaurantsTop.vue"],"sourcesContent":["<template>\r\n  <div class=\"container py-5\">\r\n    <NavTabs />\r\n    <h1 class=\"mt-5\">\r\n      人氣餐廳\r\n    </h1>\r\n    <SpinneR v-if=\"isLoading\"/>\r\n    <template v-else>\r\n      <div\r\n      class=\"card mb-3\"\r\n      style=\"max-width: 540px;margin: auto;\"\r\n    >\r\n      <div class=\"row no-gutters\" v-for=\"restaurant in restaurants\" :key=\"restaurant.id\">\r\n        <div class=\"col-md-4\">\r\n          <a href=\"#\">\r\n            <img\r\n              class=\"card-img\"\r\n              :src=\"restaurant.image\"              \r\n            />\r\n          </a>\r\n        </div>\r\n        <div class=\"col-md-8\">\r\n          <div class=\"card-body\">\r\n            <h5 class=\"card-title\">\r\n              {{restaurant.name}}\r\n            </h5>\r\n            <span class=\"badge badge-secondary\">收藏數：{{restaurant.FavoriteCount}}</span>\r\n            <p class=\"card-text\">\r\n              {{restaurant.description}}              \r\n            </p>\r\n            <router-link              \r\n              :to=\"{ name: 'dashboard', params: { id: restaurant.id } }\"              \r\n              class=\"btn btn-primary mr-2\"\r\n            >Show</router-link>\r\n\r\n            <button\r\n              v-if=\"restaurant.isFavorited\"\r\n              @click.stop.prevent=\"removeFavorite(restaurant.id)\"\r\n              type=\"button\"\r\n              class=\"btn btn-danger mr-2\"\r\n            >\r\n              移除最愛\r\n            </button>\r\n            <button\r\n              v-else\r\n              @click.stop.prevent=\"addFavorite(restaurant.id)\"\r\n              type=\"button\"\r\n              class=\"btn btn-primary\"\r\n            >\r\n              加到最愛\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    </template>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport NavTabs from \"../components/NavTabs.vue\";\r\nimport restaurantsAPI from \"./../apis/restaurants\";\r\nimport usersAPI from \"./../apis/users\";\r\nimport { Toast } from \"./../utils/helpers\";\r\nimport SpinneR from \"../components/SpinneR\"\r\n\r\nexport default {\r\n  name: \"RestaurantsTop\",\r\n  components: {\r\n    NavTabs, \r\n    SpinneR,   \r\n  },\r\n  data() {\r\n    return {\r\n      restaurants: [],\r\n      isLoading: true,\r\n    };\r\n  },\r\n  created() {\r\n    this.getRestaurantsTop();\r\n  },\r\n  methods: {\r\n    async getRestaurantsTop() {\r\n      try {\r\n        const response = await restaurantsAPI.getRestaurantsTop()\r\n\r\n        if (response.statusText !== \"OK\") {\r\n          throw new Error(\"無法載入人氣餐廳，請稍後再試\");\r\n        }\r\n\r\n        this.restaurants = response.data.restaurants\r\n        this.isLoading = false\r\n      } catch(error) {\r\n        this.isLoading = false        \r\n        Toast.fire({\r\n          icon: \"error\",\r\n          title: \"無法取得人氣餐廳\",\r\n        })\r\n      }\r\n    },   \r\n    async addFavorite(restaurantId) {\r\n      try {\r\n        const { data } = await usersAPI.addFavorite({ restaurantId });\r\n        // 檢測\r\n        if (data.status !== \"success\") {\r\n          throw new Error(data.message);\r\n        }\r\n        //加入\r\n        this.restaurants = this.restaurants.map(\r\n          restaurant => {\r\n            \r\n          }\r\n        )\r\n\r\n      } catch (error) {\r\n        Toast.fire({\r\n          icon: \"error\",\r\n          title: \"無法加到我的最愛，請稍後再試\",\r\n        });\r\n      }\r\n    },\r\n    // async addFavorite(restaurantId) {\r\n    //   try {\r\n    //     const { data } = await usersAPI.addFavorite({ restaurantId });\r\n    //     if (data.status !== \"success\") {\r\n    //       throw new Error(data.messege);\r\n    //     }\r\n    //     this.restaurants = this.restaurants.map((restaurant) => {\r\n    //       if (restaurant.id !== restaurantId) {\r\n    //         return restaurant;\r\n    //       } else {\r\n    //         return {\r\n    //           ...restaurant,\r\n    //           isFavorited: true,\r\n    //           FavoriteCount: restaurant.FavoriteCount + 1,\r\n    //         };\r\n    //       }\r\n    //     });\r\n    //   } catch (error) {\r\n    //     Toast.fire({\r\n    //       icon: \"error\",\r\n    //       title: \"無法將餐廳加入最愛，請稍後再試\",\r\n    //     });\r\n    //   }\r\n    // },\r\n    // async deleteFavorite(restaurantId) {\r\n    //   try {\r\n    //     const { data } = await usersAPI.deleteFavorite({ restaurantId });\r\n    //     if (data.status !== \"success\") {\r\n    //       throw new Error(data.messege);\r\n    //     }\r\n    //     this.restaurants = this.restaurants.map((restaurant) => {\r\n    //       if (restaurant.id !== restaurantId) {\r\n    //         return restaurant;\r\n    //       } else {\r\n    //         return {\r\n    //           ...restaurant,\r\n    //           isFavorited: false,\r\n    //           FavoriteCount: restaurant.FavoriteCount - 1,\r\n    //         };\r\n    //       }\r\n    //     });\r\n    //   } catch (error) {\r\n    //     Toast.fire({\r\n    //       icon: \"error\",\r\n    //       title: \"無法將餐廳取消最愛，請稍後再試\",\r\n    //     });\r\n    //   }\r\n    // },\r\n  },\r\n};\r\n</script>\r\n"]},"metadata":{},"sourceType":"module"}