{"ast":null,"code":"import \"core-js/modules/es.error.cause.js\";\nimport RestaurantDetail from \"../components/RestaurantDetail.vue\";\nimport RestaurantComments from \"../components/RestaurantComments.vue\";\nimport CreateComment from \"../components/CreateComment.vue\";\nimport restaurantsAPI from './../apis/restaurants';\nimport { mapState } from \"vuex\";\nimport { Toast } from './../utils/helpers';\nexport default {\n  name: \"RestauranT\",\n  components: {\n    RestaurantDetail,\n    RestaurantComments,\n    CreateComment\n  },\n\n  data() {\n    return {\n      restaurant: {\n        id: -1,\n        name: \"\",\n        categoryName: \"\",\n        image: \"\",\n        openingHours: \"\",\n        tel: \"\",\n        address: \"\",\n        description: \"\",\n        isFavorited: false,\n        isLiked: false\n      },\n      restaurantComments: []\n    };\n  },\n\n  computed: { ...mapState(['currentUser'])\n  },\n\n  beforeRouteUpdate(to, from, next) {\n    const {\n      id\n    } = to.params;\n    this.fetchRestaurant(id);\n    next();\n  },\n\n  created() {\n    const {\n      id\n    } = this.$route.params;\n    this.fetchRestaurant(id);\n  },\n\n  methods: {\n    async fetchRestaurant(restaurantId) {\n      try {\n        const response = await restaurantsAPI.getRestaurant({\n          restaurantId\n        });\n\n        if (response.statusText !== \"OK\") {\n          throw new Error(\"無法取得餐廳資料，請稍後再試\");\n        }\n\n        const {\n          restaurant,\n          isFavorited,\n          isLiked\n        } = response.data;\n        const {\n          id,\n          name,\n          Category,\n          image,\n          opening_hours: openingHours,\n          tel,\n          address,\n          description,\n          Comments\n        } = restaurant;\n        this.restaurant = {\n          id,\n          name,\n          categoryName: Category ? Category.name : '未分類',\n          image,\n          openingHours,\n          tel,\n          address,\n          description,\n          isFavorited,\n          isLiked\n        };\n        this.restaurantComments = Comments;\n      } catch (error) {\n        Toast.fire({\n          icon: 'error',\n          title: '無法取得餐廳資料，請稍後再試'\n        });\n      }\n    },\n\n    afterDeleteComment(commentId) {\n      this.restaurantComments = this.restaurantComments.filter(comment => comment.id !== commentId);\n    },\n\n    afterCreateComment(payload) {\n      console.log(payload);\n      const {\n        commentId,\n        restaurantId,\n        text\n      } = payload;\n      this.restaurantComments.push({\n        id: commentId,\n        RestaurantId: restaurantId,\n        User: {\n          id: this.currentUser.id,\n          name: this.currentUser.name\n        },\n        text,\n        createdAt: new Date()\n      });\n    }\n\n  }\n};","map":{"version":3,"mappings":";AAoBA;AACA;AACA;AACA;AACA;AACA;AAEA;EACAA,kBADA;EAGAC;IACAC,gBADA;IAEAC,kBAFA;IAGAC;EAHA,CAHA;;EAQAC;IACA;MACAC;QACAC,MADA;QAEAP,QAFA;QAGAQ,gBAHA;QAIAC,SAJA;QAKAC,gBALA;QAMAC,OANA;QAOAC,WAPA;QAQAC,eARA;QASAC,kBATA;QAUAC;MAVA,CADA;MAaAC;IAbA;EAeA,CAxBA;;EAyBAC,YACA;EADA,CAzBA;;EA4BAC;IACA;MAAAX;IAAA;IACA;IACAY;EACA,CAhCA;;EAiCAC;IACA;MAAAb;IAAA;IACA;EACA,CApCA;;EAqCAc;IACA;MACA;QACA;UAAAC;QAAA;;QACA;UACA;QACA;;QAEA;UAAAhB;UAAAQ;UAAAC;QAAA;QACA;UACAR,EADA;UAEAP,IAFA;UAGAuB,QAHA;UAIAd,KAJA;UAKAe,2BALA;UAMAb,GANA;UAOAC,OAPA;UAQAC,WARA;UASAY;QATA,IAUAnB,UAVA;QAYA;UACAC,EADA;UAEAP,IAFA;UAGAQ,8CAHA;UAIAC,KAJA;UAKAC,YALA;UAMAC,GANA;UAOAC,OAPA;UAQAC,WARA;UASAC,WATA;UAUAC;QAVA;QAaA;MACA,CAjCA,CAiCA;QACAW;UACAC,aADA;UAEAC;QAFA;MAIA;IACA,CAzCA;;IA0CAC;MACA,yDACAC,mCADA;IAGA,CA9CA;;IA+CAC;MAEAC;MACA;QAAAC;QAAAX;QAAAY;MAAA;MACA;QACA3B,aADA;QAEA4B,0BAFA;QAGAC;UACA7B,uBADA;UAEAP;QAFA,CAHA;QAOAkC,IAPA;QAQAG;MARA;IAUA;;EA7DA;AArCA","names":["name","components","RestaurantDetail","RestaurantComments","CreateComment","data","restaurant","id","categoryName","image","openingHours","tel","address","description","isFavorited","isLiked","restaurantComments","computed","beforeRouteUpdate","next","created","methods","restaurantId","Category","opening_hours","Comments","Toast","icon","title","afterDeleteComment","comment","afterCreateComment","console","commentId","text","RestaurantId","User","createdAt"],"sourceRoot":"src/views","sources":["RestauranT.vue"],"sourcesContent":["<template>\r\n  <div class=\"container py-5\">\r\n    <h1>餐廳描述頁</h1>\r\n    <!-- 餐廳資訊頁 RestaurantDetail -->\r\n    <RestaurantDetail :initial-restaurant=\"restaurant\" />\r\n    <hr />\r\n    <!-- 餐廳評論 RestaurantComments -->\r\n    <RestaurantComments\r\n      :restaurant-comments=\"restaurantComments\"\r\n      @after-delete-comment=\"afterDeleteComment\"\r\n    />\r\n    <!-- 新增評論 CreateComment -->\r\n    <CreateComment\r\n      :restaurant-id=\"restaurant.id\"\r\n      @after-create-comment=\"afterCreateComment\"\r\n    />\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport RestaurantDetail from \"../components/RestaurantDetail.vue\"\r\nimport RestaurantComments from \"../components/RestaurantComments.vue\"\r\nimport CreateComment from \"../components/CreateComment.vue\"\r\nimport restaurantsAPI from './../apis/restaurants'\r\nimport { mapState } from \"vuex\"\r\nimport { Toast } from './../utils/helpers'\r\n\r\nexport default {\r\n  name:\"RestauranT\",\r\n\r\n  components: {    \r\n    RestaurantDetail,\r\n    RestaurantComments,\r\n    CreateComment,\r\n  },\r\n  data() {\r\n    return {\r\n      restaurant: {\r\n        id: -1,\r\n        name: \"\",\r\n        categoryName: \"\",\r\n        image: \"\",\r\n        openingHours: \"\",\r\n        tel: \"\",\r\n        address: \"\",\r\n        description: \"\",\r\n        isFavorited: false,\r\n        isLiked: false,\r\n      },\r\n      restaurantComments: [],     \r\n    };\r\n  },\r\n  computed: {\r\n    ...mapState(['currentUser'])\r\n  },\r\n  beforeRouteUpdate (to, from, next) {\r\n    const { id } = to.params\r\n    this.fetchRestaurant(id)\r\n    next()\r\n  },\r\n  created() {\r\n    const { id } = this.$route.params\r\n    this.fetchRestaurant(id)\r\n  },\r\n  methods: {\r\n    async fetchRestaurant(restaurantId) {\r\n      try {\r\n        const response = await restaurantsAPI.getRestaurant({ restaurantId })\r\n        if (response.statusText !== \"OK\") {\r\n          throw new Error(\"無法取得餐廳資料，請稍後再試\");\r\n        }\r\n        \r\n        const { restaurant, isFavorited, isLiked } = response.data;\r\n        const {\r\n          id,\r\n          name,\r\n          Category,\r\n          image,\r\n          opening_hours: openingHours,\r\n          tel,\r\n          address,\r\n          description,\r\n          Comments\r\n        } = restaurant\r\n\r\n        this.restaurant = {\r\n          id,\r\n          name,\r\n          categoryName: Category ? Category.name : '未分類',\r\n          image,\r\n          openingHours,\r\n          tel,\r\n          address,\r\n          description,\r\n          isFavorited,\r\n          isLiked,\r\n        };\r\n\r\n        this.restaurantComments = Comments\r\n      } catch (error) {       \r\n        Toast.fire({\r\n          icon: 'error',\r\n          title: '無法取得餐廳資料，請稍後再試'\r\n        })\r\n      }      \r\n    },\r\n    afterDeleteComment(commentId) {\r\n      this.restaurantComments = this.restaurantComments.filter(\r\n        (comment) => comment.id !== commentId\r\n      );\r\n    },\r\n    afterCreateComment(payload) {\r\n      \r\n      console.log(payload)\r\n      const { commentId, restaurantId, text } = payload;\r\n      this.restaurantComments.push({\r\n        id: commentId,\r\n        RestaurantId: restaurantId,\r\n        User: {\r\n          id: this.currentUser.id,\r\n          name: this.currentUser.name,\r\n        },\r\n        text,\r\n        createdAt: new Date(),\r\n      });\r\n    },\r\n  },\r\n};\r\n</script>\r\n"]},"metadata":{},"sourceType":"module"}