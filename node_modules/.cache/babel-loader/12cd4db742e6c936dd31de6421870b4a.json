{"ast":null,"code":"import \"core-js/modules/es.array.includes.js\";\nimport Vue from \"vue\";\nimport VueRouter from \"vue-router\";\nimport SignIn from \"../views/SignIn.vue\";\nimport NotFound from \"../views/NotFound.vue\";\nimport RestaurantS from \"../views/RestaurantS.vue\";\nimport store from \"./../store\";\nVue.use(VueRouter); // 處理非管理者 直接透過路由進入管理頁面\n\nconst authorizeIsAdmin = (to, from, next) => {\n  const currentUser = store.state.currentUser;\n\n  if (currentUser && !currentUser.isAdmin) {\n    next('/404');\n    return;\n  }\n\n  next();\n};\n\nconst routes = [{\n  path: \"/\",\n  name: \"root\",\n  redirect: \"/signin\"\n}, {\n  path: \"/signin\",\n  name: \"sign-in\",\n  component: SignIn\n}, {\n  path: \"/signup\",\n  name: \"sign-up\",\n  component: () => import(\"../views/SignUp.vue\")\n}, {\n  path: \"/restaurants\",\n  name: \"restaurants\",\n  component: RestaurantS\n}, {\n  path: \"/restaurants/feeds\",\n  name: \"restaurants-feeds\",\n  component: () => import(\"../views/RestaurantsFeeds.vue\")\n}, {\n  path: \"/restaurants/top\",\n  name: \"restaurants-tops\",\n  component: () => import(\"../views/RestaurantsTop.vue\")\n}, {\n  path: \"/restaurants/:id\",\n  name: \"restaurant\",\n  component: () => import(\"../views/RestauranT.vue\")\n}, {\n  path: \"/restaurants/:id/dashboard\",\n  name: \"restaurant-dashboard\",\n  component: () => import(\"../views/RestaurantDashboard.vue\")\n}, {\n  path: \"/users/top\",\n  name: \"users-top\",\n  component: () => import(\"../views/UsersTop.vue\")\n}, {\n  path: \"/users/:id/edit\",\n  name: \"user-edit\",\n  component: () => import(\"../views/UserEdit.vue\")\n}, {\n  path: \"/users/:id\",\n  name: \"user\",\n  component: () => import(\"../views/UseR.vue\")\n}, {\n  path: \"/admin\",\n  exact: true,\n  redirect: \"/admin/restaurants\",\n  beforeEnter: authorizeIsAdmin\n}, {\n  path: \"/admin/categories\",\n  name: \"admin-categories\",\n  component: () => import(\"../views/AdminCategories.vue\"),\n  beforeEnter: authorizeIsAdmin\n}, {\n  path: \"/admin/restaurants\",\n  name: \"admin-restaurants\",\n  component: () => import(\"../views/AdminRestaurants.vue\"),\n  beforeEnter: authorizeIsAdmin\n}, {\n  path: \"/admin/restaurants/new\",\n  name: \"admin-restaurant-new\",\n  component: () => import(\"../views/AdminRestaurantNew.vue\"),\n  beforeEnter: authorizeIsAdmin\n}, {\n  path: \"/admin/restaurants/:id\",\n  name: \"admin-restaurant\",\n  component: () => import(\"../views/AdminRestaurant.vue\"),\n  beforeEnter: authorizeIsAdmin\n}, {\n  path: \"/admin/restaurants/:id/edit\",\n  name: \"admin-restaurant-edit\",\n  component: () => import(\"../views/AdminRestaurantEdit.vue\"),\n  beforeEnter: authorizeIsAdmin\n}, {\n  path: \"*\",\n  name: \"not-found\",\n  component: NotFound\n}];\nconst router = new VueRouter({\n  linkExactActiveClass: \"active\",\n  routes\n}); // 監聽\"全域\"的「切換路由」事件\n\nrouter.beforeEach(async (to, from, next) => {\n  const tokenInLocalStorage = localStorage.getItem('token');\n  const tokenInStore = store.state.token;\n  let isAuthenticated = store.state.isAuthenticated;\n\n  if (tokenInLocalStorage && tokenInLocalStorage !== tokenInStore) {\n    // 不一樣就需要重新驗證\n    isAuthenticated = await store.dispatch('fetchCurrentUser');\n  }\n\n  const pathsWithoutAuthentication = ['sign-up', 'sign-in'];\n\n  if (!isAuthenticated && !pathsWithoutAuthentication.includes(to.name)) {\n    next('/signin');\n    return;\n  }\n\n  if (isAuthenticated && pathsWithoutAuthentication.includes(to.name)) {\n    next('/restaurants');\n    return;\n  }\n\n  next();\n});\nexport default router;","map":{"version":3,"names":["Vue","VueRouter","SignIn","NotFound","RestaurantS","store","use","authorizeIsAdmin","to","from","next","currentUser","state","isAdmin","routes","path","name","redirect","component","exact","beforeEnter","router","linkExactActiveClass","beforeEach","tokenInLocalStorage","localStorage","getItem","tokenInStore","token","isAuthenticated","dispatch","pathsWithoutAuthentication","includes"],"sources":["C:/Users/WING JING/Desktop/ac/3/restaurant-vue/src/router/index.js"],"sourcesContent":["import Vue from \"vue\";\r\nimport VueRouter from \"vue-router\";\r\n\r\nimport SignIn from \"../views/SignIn.vue\";\r\nimport NotFound from \"../views/NotFound.vue\";\r\nimport RestaurantS from \"../views/RestaurantS.vue\";\r\n\r\nimport store from \"./../store\"\r\n\r\nVue.use(VueRouter);\r\n\r\n// 處理非管理者 直接透過路由進入管理頁面\r\nconst authorizeIsAdmin = (to, from, next) => {\r\n  const currentUser = store.state.currentUser\r\n  if (currentUser && !currentUser.isAdmin) {\r\n    next('/404')\r\n    return\r\n  }\r\n  next()\r\n}\r\n\r\nconst routes =  [\r\n  {\r\n    path: \"/\",\r\n    name: \"root\",\r\n    redirect: \"/signin\",\r\n  },\r\n  {\r\n    path: \"/signin\",\r\n    name: \"sign-in\",\r\n    component: SignIn,\r\n  },\r\n  {\r\n    path: \"/signup\",\r\n    name: \"sign-up\",\r\n    component: () => import(\"../views/SignUp.vue\"),\r\n  },\r\n  {\r\n    path: \"/restaurants\",\r\n    name: \"restaurants\",\r\n    component: RestaurantS,\r\n  },\r\n  {\r\n    path: \"/restaurants/feeds\",\r\n    name: \"restaurants-feeds\",\r\n    component: () => import(\"../views/RestaurantsFeeds.vue\"),\r\n  },\r\n  {\r\n    path: \"/restaurants/top\",\r\n    name: \"restaurants-tops\",\r\n    component: () => import(\"../views/RestaurantsTop.vue\"),\r\n  },\r\n  {\r\n    path: \"/restaurants/:id\",\r\n    name: \"restaurant\",\r\n    component: () => import(\"../views/RestauranT.vue\"),\r\n  }, \r\n  {\r\n    path: \"/restaurants/:id/dashboard\",\r\n    name: \"restaurant-dashboard\",\r\n    component: () => import(\"../views/RestaurantDashboard.vue\"),\r\n  }, \r\n  {\r\n    path: \"/users/top\",\r\n    name: \"users-top\",\r\n    component: () => import(\"../views/UsersTop.vue\"),\r\n  },\r\n  {\r\n    path: \"/users/:id/edit\",\r\n    name: \"user-edit\",\r\n    component: () => import(\"../views/UserEdit.vue\"),\r\n  },\r\n  {\r\n    path: \"/users/:id\",\r\n    name: \"user\",\r\n    component: () => import(\"../views/UseR.vue\"),\r\n  },\r\n  {\r\n    path: \"/admin\",\r\n    exact: true,\r\n    redirect: \"/admin/restaurants\",\r\n    beforeEnter: authorizeIsAdmin\r\n  },\r\n  {\r\n    path: \"/admin/categories\",\r\n    name: \"admin-categories\",\r\n    component: () => import(\"../views/AdminCategories.vue\"),\r\n    beforeEnter: authorizeIsAdmin\r\n  },\r\n  {\r\n    path: \"/admin/restaurants\",\r\n    name: \"admin-restaurants\",\r\n    component: () => import(\"../views/AdminRestaurants.vue\"),\r\n    beforeEnter: authorizeIsAdmin\r\n  },\r\n  {\r\n    path: \"/admin/restaurants/new\",\r\n    name: \"admin-restaurant-new\",\r\n    component: () => import(\"../views/AdminRestaurantNew.vue\"),\r\n    beforeEnter: authorizeIsAdmin\r\n  },\r\n  {\r\n    path: \"/admin/restaurants/:id\",\r\n    name: \"admin-restaurant\",\r\n    component: () => import(\"../views/AdminRestaurant.vue\"),\r\n    beforeEnter: authorizeIsAdmin\r\n  },\r\n  {\r\n    path: \"/admin/restaurants/:id/edit\",\r\n    name: \"admin-restaurant-edit\",\r\n    component: () => import(\"../views/AdminRestaurantEdit.vue\"),\r\n    beforeEnter: authorizeIsAdmin\r\n  },\r\n  {\r\n    path: \"*\",\r\n    name: \"not-found\",\r\n    component: NotFound,\r\n  },\r\n] \r\n\r\nconst router = new VueRouter({\r\n  linkExactActiveClass: \"active\",\r\n  routes\r\n})\r\n\r\n// 監聽\"全域\"的「切換路由」事件\r\nrouter.beforeEach(async (to, from, next) => {  \r\n  const tokenInLocalStorage = localStorage.getItem('token')\r\n  const tokenInStore = store.state.token\r\n  let isAuthenticated = store.state.isAuthenticated\r\n  \r\n  if(tokenInLocalStorage && tokenInLocalStorage !== tokenInStore) {\r\n    // 不一樣就需要重新驗證\r\n    isAuthenticated = await store.dispatch('fetchCurrentUser')\r\n  }\r\n\r\n  const pathsWithoutAuthentication = ['sign-up', 'sign-in']\r\n\r\n  if (!isAuthenticated  && !pathsWithoutAuthentication.includes(to.name)) {\r\n    next('/signin')\r\n    return\r\n  }\r\n\r\n  if (isAuthenticated  && pathsWithoutAuthentication.includes(to.name)) {\r\n    next('/restaurants')\r\n    return\r\n  }  \r\n  next()\r\n})\r\n\r\nexport default router\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}