{"ast":null,"code":"import \"core-js/modules/es.array.includes.js\";\nimport Vue from \"vue\";\nimport VueRouter from \"vue-router\";\nimport SignIn from \"../views/SignIn.vue\";\nimport NotFound from \"../views/NotFound.vue\";\nimport RestaurantS from \"../views/RestaurantS.vue\";\nimport store from \"./../store\";\nVue.use(VueRouter); // 處理非管理者 直接透過路由進入管理頁面\n\nconst authorizeIsAdmin = (to, from, next) => {\n  const currentUser = store.state.currentUser;\n\n  if (currentUser && !currentUser.isAdmin) {\n    next('/404');\n    return;\n  }\n\n  next();\n};\n\nconst routes = [{\n  path: \"/\",\n  name: \"root\",\n  redirect: \"/signin\"\n}, {\n  path: \"/admin\",\n  exact: true,\n  redirect: \"/admin/restaurants\"\n}, {\n  path: \"/admin/categories\",\n  name: \"admin-categories\",\n  component: () => import(\"../views/AdminCategories.vue\")\n}, {\n  path: \"/admin/restaurants\",\n  name: \"admin-restaurants\",\n  component: () => import(\"../views/AdminRestaurants.vue\"),\n  beforeEnter: authorizeIsAdmin\n}, {\n  path: \"/admin/restaurants/new\",\n  name: \"admin-restaurant-new\",\n  component: () => import(\"../views/AdminRestaurantNew.vue\"),\n  beforeEnter: authorizeIsAdmin\n}, {\n  path: \"/admin/restaurants/:id/edit\",\n  name: \"admin-restaurant-edit\",\n  component: () => import(\"../views/AdminRestaurantEdit.vue\"),\n  beforeEnter: authorizeIsAdmin\n}, {\n  path: \"/admin/restaurants/:id\",\n  name: \"admin-restaurant\",\n  component: () => import(\"../views/AdminRestaurant.vue\"),\n  beforeEnter: authorizeIsAdmin\n}, {\n  path: \"/restaurants\",\n  name: \"restaurants\",\n  component: RestaurantS\n}, {\n  path: \"/restaurants/feeds\",\n  name: \"restaurants-feeds\",\n  component: () => import(\"../views/RestaurantsFeeds.vue\")\n}, {\n  path: \"/restaurants/top\",\n  name: \"restaurants-tops\",\n  component: () => import(\"../views/RestaurantsTop.vue\")\n}, {\n  path: \"/restaurants/:id\",\n  name: \"restaurant\",\n  component: () => import(\"../views/RestauranT.vue\")\n}, {\n  path: \"/restaurants/:id/dashboard\",\n  name: \"dashboard\",\n  component: () => import(\"../views/RestaurantDashboard.vue\")\n}, {\n  path: \"/user\",\n  name: \"user\",\n  component: () => import(\"../views/UseR.vue\")\n}, {\n  path: \"/users/top\",\n  name: \"users-top\",\n  component: () => import(\"../views/UsersTop.vue\")\n}, {\n  path: \"/user/:id/edit\",\n  name: \"user-edit\",\n  component: () => import(\"../views/UserEdit.vue\")\n}, {\n  path: \"*\",\n  name: \"not-found\",\n  component: NotFound\n}];\nconst router = new VueRouter({\n  linkExactActiveClass: \"active\",\n  routes\n}); // 監聽\"全域\"的「切換路由」事件\n\nrouter.beforeEach(async (to, from, next) => {\n  const tokenInLocalStorage = localStorage.getItem('token');\n  const tokenInStore = store.state.token;\n  let isAuthenticated = store.state.isAuthenticated;\n\n  if (tokenInLocalStorage && tokenInLocalStorage !== tokenInStore) {\n    // 不一樣就需要重新驗證\n    isAuthenticated = await store.dispatch('fetchCurrentUser');\n  }\n\n  const pathsWithoutAuthentication = ['sign-up', 'sign-in'];\n\n  if (!isAuthenticated && !pathsWithoutAuthentication.includes(to.name)) {\n    next('/signin');\n    return;\n  }\n\n  if (isAuthenticated && pathsWithoutAuthentication.includes(to.name)) {\n    next('/restaurants');\n    return;\n  }\n\n  next();\n});\nexport default router;","map":{"version":3,"names":["Vue","VueRouter","SignIn","NotFound","RestaurantS","store","use","authorizeIsAdmin","to","from","next","currentUser","state","isAdmin","routes","path","name","redirect","exact","component","beforeEnter","router","linkExactActiveClass","beforeEach","tokenInLocalStorage","localStorage","getItem","tokenInStore","token","isAuthenticated","dispatch","pathsWithoutAuthentication","includes"],"sources":["C:/Users/WING JING/Desktop/ac/3/restaurant-vue/src/router/index.js"],"sourcesContent":["import Vue from \"vue\";\r\nimport VueRouter from \"vue-router\";\r\n\r\nimport SignIn from \"../views/SignIn.vue\";\r\nimport NotFound from \"../views/NotFound.vue\";\r\nimport RestaurantS from \"../views/RestaurantS.vue\";\r\n\r\nimport store from \"./../store\"\r\n\r\nVue.use(VueRouter);\r\n\r\n// 處理非管理者 直接透過路由進入管理頁面\r\nconst authorizeIsAdmin = (to, from, next) => {\r\n  const currentUser = store.state.currentUser\r\n  if (currentUser && !currentUser.isAdmin) {\r\n    next('/404')\r\n    return\r\n  }\r\n  next()\r\n}\r\n\r\nconst routes =  [\r\n  {\r\n    path: \"/\",\r\n    name: \"root\",\r\n    redirect: \"/signin\",\r\n  },\r\n  {\r\n    path: \"/admin\",\r\n    exact: true,\r\n    redirect: \"/admin/restaurants\",\r\n  },\r\n  {\r\n    path: \"/admin/categories\",\r\n    name: \"admin-categories\",\r\n    component: () => import(\"../views/AdminCategories.vue\"),\r\n  },\r\n  {\r\n    path: \"/admin/restaurants\",\r\n    name: \"admin-restaurants\",\r\n    component: () => import(\"../views/AdminRestaurants.vue\"),\r\n    beforeEnter: authorizeIsAdmin\r\n  },\r\n  {\r\n    path: \"/admin/restaurants/new\",\r\n    name: \"admin-restaurant-new\",\r\n    component: () => import(\"../views/AdminRestaurantNew.vue\"),\r\n    beforeEnter: authorizeIsAdmin\r\n  },\r\n  {\r\n    path: \"/admin/restaurants/:id/edit\",\r\n    name: \"admin-restaurant-edit\",\r\n    component: () => import(\"../views/AdminRestaurantEdit.vue\"),\r\n    beforeEnter: authorizeIsAdmin\r\n  },\r\n  {\r\n    path: \"/admin/restaurants/:id\",\r\n    name: \"admin-restaurant\",\r\n    component: () => import(\"../views/AdminRestaurant.vue\"),\r\n    beforeEnter: authorizeIsAdmin\r\n  },\r\n\r\n  {\r\n    path: \"/restaurants\",\r\n    name: \"restaurants\",\r\n    component: RestaurantS,\r\n  },\r\n  {\r\n    path: \"/restaurants/feeds\",\r\n    name: \"restaurants-feeds\",\r\n    component: () => import(\"../views/RestaurantsFeeds.vue\"),\r\n  },\r\n  {\r\n    path: \"/restaurants/top\",\r\n    name: \"restaurants-tops\",\r\n    component: () => import(\"../views/RestaurantsTop.vue\"),\r\n  },\r\n  {\r\n    path: \"/restaurants/:id\",\r\n    name: \"restaurant\",\r\n    component: () => import(\"../views/RestauranT.vue\"),\r\n  },\r\n  {\r\n    path: \"/restaurants/:id/dashboard\",\r\n    name: \"dashboard\",\r\n    component: () => import(\"../views/RestaurantDashboard.vue\"),\r\n  },    \r\n  {\r\n    path: \"/user\",\r\n    name: \"user\",\r\n    component: () => import(\"../views/UseR.vue\"),\r\n  },\r\n  {\r\n    path: \"/users/top\",\r\n    name: \"users-top\",\r\n    component: () => import(\"../views/UsersTop.vue\"),\r\n  },\r\n  {\r\n    path: \"/user/:id/edit\",\r\n    name: \"user-edit\",\r\n    component: () => import(\"../views/UserEdit.vue\"),\r\n  },\r\n  {\r\n    path: \"*\",\r\n    name: \"not-found\",\r\n    component: NotFound,\r\n  },\r\n] \r\n\r\nconst router = new VueRouter({\r\n  linkExactActiveClass: \"active\",\r\n  routes\r\n})\r\n\r\n// 監聽\"全域\"的「切換路由」事件\r\nrouter.beforeEach(async (to, from, next) => {  \r\n  const tokenInLocalStorage = localStorage.getItem('token')\r\n  const tokenInStore = store.state.token\r\n  let isAuthenticated = store.state.isAuthenticated\r\n  \r\n  if(tokenInLocalStorage && tokenInLocalStorage !== tokenInStore) {\r\n    // 不一樣就需要重新驗證\r\n    isAuthenticated = await store.dispatch('fetchCurrentUser')\r\n  }\r\n\r\n  const pathsWithoutAuthentication = ['sign-up', 'sign-in']\r\n\r\n  if (!isAuthenticated  && !pathsWithoutAuthentication.includes(to.name)) {\r\n    next('/signin')\r\n    return\r\n  }\r\n\r\n  if (isAuthenticated  && pathsWithoutAuthentication.includes(to.name)) {\r\n    next('/restaurants')\r\n    return\r\n  }  \r\n  next()\r\n})\r\n\r\nexport default router\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}